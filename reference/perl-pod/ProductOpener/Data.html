<html><head><title>ProductOpener::Data</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" >
<link rel="stylesheet" title="simple.min" type="text/css" href="../simple.min.css" media="all" >

</head>
<body class='pod'>
<!--
  generated by Pod::Simple::HTML v3.42,
  using Pod::Simple::PullParser v3.42,
  under Perl v5.034000 at Tue Jan 10 17:49:48 2023 GMT.

 If you want to change this HTML document, you probably shouldn't do that
   by changing it directly.  Instead, see about changing the calling options
   to Pod::Simple::HTML, and/or subclassing Pod::Simple::HTML,
   then reconverting this document from the Pod source.
   When in doubt, email the author of Pod::Simple::HTML for advice.
   See 'perldoc Pod::Simple::HTML' for more info.

-->

<!-- start doc -->
<p class="backlinktop"><b><a name="___top" href="../index.html" accesskey="1" title="All Documents">&lt;&lt;</a></b></p>

<div class='indexgroup'>
<ul   class='indexList indexList1'>
  <li class='indexItem indexItem1'><a href='#NAME'>NAME</a>
  <li class='indexItem indexItem1'><a href='#DESCRIPTION'>DESCRIPTION</a>
  <li class='indexItem indexItem1'><a href='#FUNCTIONS'>FUNCTIONS</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#execute_query(_%24subroutine_)'>execute_query( $subroutine )</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Arguments'>Arguments</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#subroutine_%24sub'>subroutine $sub</a>
      </ul>
      <li class='indexItem indexItem3'><a href='#Return_value'>Return value</a>
      <li class='indexItem indexItem3'><a href='#Synopsis'>Synopsis</a>
    </ul>
    <li class='indexItem indexItem2'><a href='#get_products_collection()'>get_products_collection()</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Arguments'>Arguments</a>
      <li class='indexItem indexItem3'><a href='#Return_values'>Return values</a>
    </ul>
    <li class='indexItem indexItem2'><a href='#get_products_tags_collection()'>get_products_tags_collection()</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Arguments'>Arguments</a>
      <li class='indexItem indexItem3'><a href='#Return_values'>Return values</a>
    </ul>
    <li class='indexItem indexItem2'><a href='#get_mongodb_client()'>get_mongodb_client()</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Arguments'>Arguments</a>
      <li class='indexItem indexItem3'><a href='#Return_values'>Return values</a>
    </ul>
  </ul>
</ul>
</div>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="NAME"
>NAME</a></h1>

<p>ProductOpener::Data - methods to create or get the mongoDB client and fetch &#34;data collections&#34; from the MongoDB database;</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="DESCRIPTION"
>DESCRIPTION</a></h1>

<p>The module implements the methods required to fetch certain collections from the MongoDB database.
The functions used in this module are responsible for executing queries,
to get connection to database and also to select the collection required.</p>

<p>The module exposes 2 distinct kinds of collections,
products and products_tags,
returned by the Data::get_products_collections and the Data::get_products_tags_collections methods respectively.</p>

<p>The products collection contains a complete document for each product in the OpenFoodFacts database which exposes all available information about the product.</p>

<p>The products_tags collection contains a stripped down version of the data in the products collection,
where each product entry has a select few fields,
including fields used in tags.
The main purpose of having this copy is to improve performance of aggregate queries for an improved user experience and more efficient resource usage.
This collection was initially proposed in <a href="https://github.com/openfoodfacts/openfoodfacts-server/issues/1610" class="podlinkurl"
>issue#1610</a> on GitHub,
where some additional context is available.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="FUNCTIONS"
>FUNCTIONS</a></h1>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="execute_query(_$subroutine_)"
>execute_query( $subroutine )</a></h2>

<p><code>execute_query()</code> executes a query on the database.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Arguments"
>Arguments</a></h3>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="subroutine_$sub"
>subroutine $sub</a></h4>

<p>A query subroutine that performs a query against the database.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Return_value"
>Return value</a></h3>

<p>The function returns the return value of the query subroutine $sub passed as a parameter to it.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Synopsis"
>Synopsis</a></h3>

<p>eval { $result = execute_query(sub { return get_products_collection()-&#62;query({})-&#62;sort({code =&#62; 1}); }); }</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="get_products_collection()"
>get_products_collection()</a></h2>

<p><code>get_products_collection()</code> establishes a connection to MongoDB and uses timeout as an argument.
This then selects a collection from within the database.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Arguments"
>Arguments</a></h3>

<p>This method takes in arguments of integer type (user defined timeout in milliseconds).
It is optional for this subroutine to have an argument.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Return_values"
>Return values</a></h3>

<p>Returns a mongoDB collection object.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="get_products_tags_collection()"
>get_products_tags_collection()</a></h2>

<p><code>get_products_collection()</code> This selects the product tag collection from within the database.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Arguments"
>Arguments</a></h3>

<p>This method takes in arguments of integer type (user defined timeout in milliseconds).
It is optional for this subroutine to have an argument.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Return_values"
>Return values</a></h3>

<p>Returns a mongoDB collection.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="get_mongodb_client()"
>get_mongodb_client()</a></h2>

<p><code>get_mongodb_client()</code> gets the MongoDB client.
It first checks if the client already exists and if not,
it creates and configures a new MongoDB::MongoClient.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Arguments"
>Arguments</a></h3>

<p>This method takes in arguments of integer type (user defined timeout in milliseconds).
It is optional for this subroutine to have an argument.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Return_values"
>Return values</a></h3>

<p>Returns $client of type MongoDB::MongoClient object.</p>
<p class="backlinkbottom"><b><a name="___bottom" href="../index.html" title="All Documents">&lt;&lt;</a></b></p>

<!-- end doc -->

</body></html>
